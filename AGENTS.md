# AGENTS.md

This file provides guidance to AI agents when working with code in this repository.

## Build Commands

Build the site:
```bash
./make
```

Watch for changes and rebuild automatically (requires `entr` and `ts`):
```bash
./make watch
```

Local dev server:
```bash
./make serve
```

Clean generated files:
```bash
rake clean
```

### CV Build (in cv/ directory)

```bash
cd cv && npm install && ./make
```

This generates `cv/index.html` from ERB template and `cv/cv.pdf` using electron-pdf.

## Architecture

This is a static site generator for a personal homepage, built with Ruby Rake and ERB templates.

### Content Structure

- **Blog posts**: `posts/YYYY-MM-DD_slug.md` → compiled to `docs/posts/slug.html`
- **Notes**: `notes/*.md` → compiled to `docs/notes/*.html`
- **Links**: `notes/links.md` → `docs/links.html`
- **Index**: Generated from `templates/index.html.erb` → `docs/index.html`

### Build Pipeline

The Rakefile orchestrates the build:
1. Markdown files are converted to intermediate HTML via pandoc (stored in `.tmp/`)
2. Intermediate HTML is wrapped with ERB templates to produce final HTML in `docs/`
3. Posts also generate link preview images (requires Chrome and Docker/imagemagick)
4. An Atom feed (`atom.xml`) is generated from blog posts

### Key Files

- `Rakefile` - Build system with `Post` and `Note` classes
- `make` - Shell wrapper for rake commands
- `templates/` - ERB templates (index, post, note, links, notes, head)
- `templates/style.css` - Site-wide styles

### Dependencies

- Ruby with `rake`, `erubi`, `nokogiri` gems (nokogiri is inline-installed via bundler)
- `pandoc` for markdown conversion
- For link previews: Chrome binary and Docker with imagemagick

## Build Output Directory

The `docs/` directory is the GitHub Pages root. Static assets (`docs/assets/`, `docs/youwashock/`) live directly in `docs/` and are version-controlled. Post assets live in `posts/assets/` and are copied to `docs/posts/assets/` during build (so posts work in isolation). Generated files (HTML, copied markdown) are also written to `docs/`.

### Output Structure

- `docs/index.html`, `docs/links.html`, `docs/notes.html`, `docs/atom.xml` (generated)
- `docs/posts/*.html` and `docs/posts/*.md` (compiled posts + copied source markdown)
- `docs/notes/*.html` and `docs/notes/*.md` (compiled notes + copied source markdown)
- `docs/assets/` (static assets including link preview images, checked in)
- `docs/youwashock/` (static content, checked in)
- `docs/posts/assets/` (copied from `posts/assets/`)
- `docs/style.css` (copied from `templates/style.css`)
- `docs/cv/` (CV HTML and PDF, built separately via `cd cv && ./make`)

### Backwards Compatibility

Redirect HTML files are generated by the Rakefile `generate_redirects` task so old post URLs continue to work:
- `2022-12-03_aoc3.html` → redirects to `posts/2022-12-03_aoc3.html`
- `2023-05-07_ruby-bug-shell-gem.html` → redirects to `posts/2023-05-07_ruby-bug-shell-gem.html`
- `2023-11-05_ruby-ascii-8bit.html` → redirects to `posts/2023-11-05_ruby-ascii-8bit.html`
- `2024-05-25_just-use-curl.html` → redirects to `posts/2024-05-25_just-use-curl.html`
- `2025-02-01_k8s-dns.html` → redirects to `posts/2025-02-01_k8s-dns.html`

### Serving Markdown Files

Source markdown files (`posts/*.md`, `notes/*.md`, `notes/links.md`) and generated `index.md` are copied to `docs/` so they can be served directly alongside the generated HTML.
